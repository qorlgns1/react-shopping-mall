# 쇼핑몰

과거 프로젝트에는 라이브러리 없이 만들어 보려고 노력했었다.  
이번 토이프로젝트는 타입스크립트 + 여러 라이브러리를 사용해보며 학습하며 적용해보자.

**[배포 URL]**

- URL: https://react-shopping-mall-two.vercel.app/

**[계정]**

- 🧑🏻‍💻 id: test2020
- 🔐 password: test2020

## 기술 스택

- react
- recoil, recoil-persist
- react-router v6
- axios
- styled-component
- react-hook-form
- embla-carousel-react

## 구현 사항 목록

- 메인페이지
  - [x] 반응형 레이아웃 구현
  - [x] 케러셀을 적용해본다.
  - [x] 상품데이터를 불러오고 fetching 될 때 더 나은 UX를 위해 skeleton-ui 보여준다.
  - [x] 스크롤을 내리면 상품데이터를 추가로 불러온다.(무한스크롤 구현)
- 로그인
  - [x] 반응형 레이아웃 구현
  - [x] 로그인이 성공하면 성공메시지를 보여주고, 실패하면 실패 메시지를 보여준다.
- 로그아웃
  - [x] 로그아웃이 성공하면 성공메시지를 보여준다.
- 회원가입
  - [x] 반응형 레이아웃 구현
  - [x] 구매자 회원가입 기능 구현
    - [x] 아이디를 입력하고 중복확인을 한다.
    - [x] 비밀번호를 8자 이상, 대소문자를 하나이상 포함하도록 유효성 검사한다.
    - [x] 비밀번호확인을 통해 두개의 입력받은 비밀번호가 일치한지 확인한다.
    - [x] 이름을 입력한다.
    - [x] 휴대폰번호를 입력할 때 prefix number는 selectbox로 구현한다.
      - [x] select태그와 option태그를 사용하면 디자인을 할 수 없어서 버튼 태그와 ul태그로 selectbox를 구현한다.
      - [x] selectbox(버튼태그) 바깥을 누르면 셀렉트 박스가 닫히는 기능을 구현한다.
    - [ ] 이메일을 입력한다.
  - [x] 판매자 회원가입 기능 구현
    - [x] 구매자 회원가입과 기능을 동일하게 한다. 아래 사항을 추가로 입력받는다.
    - [x] 사업자번호를 입력하고 중복확인 한다.
    - [x] 스토어이름을 입력한다.
- 상품 상세 페이지
  - [x] 반응형 레이아웃 구현
  - [x] 메인페이지에서 상품을 누르면 상품 상세페이지에서 상세정보를 보여준다.
  - [x] 상품 상세페이지에서 초기에는 클릭된 상품의 정보를 보여주고, 서버에서 최신 상품 데이터를 조회해 보여준다.
  - [x] 장바구니 버튼을 누르면 장바구니에 추가한다.
    - [x] 장바구니 버튼 클릭 시 최대 재고를 넘게 추가하면 재고량을 장바구니에 추가하고, 그렇지 않으면 입력한 수량만큼 장바구니에 추가한다.
  - [x] 제품의 수량이 존재하지 않으면 품절로 표시한다.
- 장바구니 페이지
  - 공통
    - [ ] 반응형 레이아웃 구현
    - [x] 상단에 장바구니 버튼을 누르면 장바구니로 이동한다.
    - [x] 장바구니 데이터를 불러오면서 사용자에게 스켈레톤 UI로 보여준다.
    - [x] 제품의 수량이 존재하지 않으면 품절로 표시하고, 주문하기 버튼을 비활성화 시킨다.
  - 비회원
    - [x] 비회원이 상품을 장바구니에 넣으면 로컬스토리지에 저장하고, 장바구니 페이지에 들어가면 데이터를 보여준다.
  - 회원
    - [ ] 비회원이 장바구니에 추가하고, 로그인하면 로컬스토리지에 저장된 장바구니 데이터를 삭제하고, 장바구니를 로그인한 유저 장바구니에 서버로 업데이트 한다.
    - [ ] 기존에 장바구니에 있던 상품이면 수량을 증가시킨다.
    - [ ] 수량이 재고수량보다 많으면 재고수량을 보여준다.
    - [ ] 기존 유저정보와 연관된 장바구니(서버데이터)에 존재하지 않은 상품이면 서버에 데이터를 보내 장바구니에 저장한다.
  - [ ]
- [ ] ...

## 프로젝트를 하면서 고민한 나의 생각 정리하기

1. 고객이 상품정보를 보기 위해 상품을 클릭했을 때 그 데이터를 다시 fetching해 올 것인가?

- 쇼핑몰은 처음에 상품 데이터를 불러온다.  
  메인페이지에서 불러온 상품 데이터를 상태관리하고, 고객이 상품을 눌렀을 때 누른 상품의 데이터를 fetching 하지말고, 상태관리한 정보를 토대로 상세페이지에 보여주면 된다고 생각한다.
  - 하지만 이렇게 되면 무결성에 문제가 생길 수 있다. 그렇기 때문에 stale한 데이터를 보여주지 않기 위해 리액트쿼리를 이용해 해결하였다.

2. React-query에 대한 학습과 도입

- 현재 recoil을 가지고 상태관리 하고 있는데 react-query를 도입할것인가?
  - react-query를 이용하면 캐싱과 무한스크롤 등을 쉽게 구현할 수 있다.  
    react-query로 서버의 상태와 클라이언트의 상태관리를 할 수 있다고 보았는데, 그럼 recoil을 사용하지말고 react-query만 사용해야 하는 것인가?
  - 우선 recoil의 편리한 상태관리를 사용하면서 부가적인 기능을 사용하기 위해 react-query도 사용해보자. 둘 다 사용해보다보면 답이 나오겠지..!

3. 회원가입할 때 휴대폰번호 앞자리를 입력받는 셀렉트박스 구현

- 기존에 사용하는 select 태그와 option 태그를 사용하면 option 태그에 css를 적용할 수 없는 문제점을 발견했다. 그래서 button 태그와 ul태그를 이용해서 버튼을 누르면 ul태그가 보여지고 다시 버튼태그를 누르면 ul태그를 숨겨야했다. 하지만 사용자는 버튼태그 바깥을 눌러도 ul태그를 숨기길 바랄것이라고 생각했다.
  - 해결방법
  1. 버튼을 누르면 버튼을 눌렀는지에 대한 상태관리를 했다.
  2. 버튼의 상태에 따른 변화(스타일드컴포넌트 및 useState로 구현)
     - 버튼이 눌러짐: ul태그가 보여지고, 버튼태그에 있는 화살표 방향이 아래로 향한다.
     - 버튼이 안눌러짐: ul태그가 숨겨지고, 버튼태그에 있는 화살표 방향이 위로 향한다.
  3. 버튼태그가 안눌러진 상태라면 누를때 root 태그에 addEventListener 를 걸어줬다. 3번째 인자로 `{ once: true },` 속성을 주면 이벤트를 등록해서 한번만 사용하고 이벤트를 제거시킬 수 있었다.
  4. 3번을 한 결과 외부에서 버튼을 누르면 ul태그를 닫을 수 있었다.
  5. ul 태그에 있는 하나의 li를 클릭할때도 해결을 해줘야했다.
  6. 5번은 이벤트흐름은 버블링이 우선적으로 발생되니까 ul태그를 중 하나의 li를 클릭하면 `event.stopPropagation()` 을 이용해 root의 이벤트 실행을 막았다. 그결과 한번만 생성되는 root의 이벤트는 이벤트 전파를 막았기때문에 실행이 되지않고 이벤트를 제거시킬 수 있었다.
